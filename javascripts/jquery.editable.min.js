;(function($,window,document,undefined){var pluginName="editable",defaults={'modalId':'myModal','formUri':'/form/form.html','buttonPrototype':'<a role="button" class="btn">Edit</a>','sendData':'options','afterHtmlLoad':null,'afterFormLoad':null};function Plugin(element,options){this.element=element;this.options=$.extend({},defaults,options);this._defaults=defaults;this._name=pluginName;this.init()}Plugin.prototype={init:function(){var plugin=this;var options=this.options;this.modal=$('#'+options.modalId);$('.editable').each(function(){var dataAttr='data-'+options.sendData;var $button=$(options.buttonPrototype).addClass('btn-j-editable').attr('data-toggle','modal');var $element=$(this);$button.attr(dataAttr,JSON.stringify($element.data(options.sendData)));$button.attr('data-target','#'+options.modalId);$element.removeAttr(dataAttr);$element.prepend($button);$button.click(function(event){event.preventDefault();plugin.applyButtonClickAction($(this),$element,options)})});var $modal=this.modal;$modal.children('.modal-footer').find('button[type="submit"]').click(function(event){event.preventDefault();$modal.find('form').submit();$modal.modal('hide')})},applyButtonClickAction:function(button,element,options){var plugin=this;var $modal=this.modal;var $element=element;var $button=button;$.ajax({url:options.formUri,type:'get',cache:false,data:$button.data(options.sendData),dataType:'html',success:function(response){$modal.find('.modal-body').html(response);$modal.find('form').on('submit',function(){plugin.modalFormSubmit($(this),$element,$button,options);return false});if(typeof options.afterFormLoad==='function'){options.afterFormLoad()}},})},modalFormSubmit:function(form,element,button,options){var plugin=this;var $element=element;var $form=form;var $button=button;$.ajax({url:$form.attr('action'),type:'post',data:$form.serialize(),dataType:'html',success:function(response){var $btnClone=$button.clone();$btnClone.click(function(event){event.preventDefault();plugin.applyButtonClickAction($(this),$element,options)});$element.empty().html(response).prepend($btnClone);if(typeof options.afterHtmlLoad==='function'){options.afterHtmlLoad()}},})}};$.fn[pluginName]=function(options){return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,options))}})}})(jQuery,window,document);
